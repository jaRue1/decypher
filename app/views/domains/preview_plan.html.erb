<div class="p-8 max-w-4xl mx-auto">
  <%= link_to "← Back to Wizard", setup_wizard_domain_path(@domain.slug), class: "text-slate-400 hover:text-slate-200 text-sm" %>

  <div class="mt-6">
    <h1 class="font-mono text-2xl text-slate-100">Your <%= @domain.name %> Plan</h1>
    <p class="text-slate-400 mt-2">Review the plan generated by The Operator.</p>
  </div>

  <!-- Level Assessment -->
  <div class="mt-8 bg-slate-900 border border-slate-700 rounded-lg p-6">
    <div class="flex items-start justify-between">
      <div>
        <span class="font-mono text-xs uppercase tracking-widest text-slate-400">Assessed Level</span>
        <span class="block font-mono text-4xl text-blue-400 mt-2">L<%= @plan.dig('level_assessment', 'current_level') %></span>
        <span class="text-slate-300"><%= level_title(@plan.dig('level_assessment', 'current_level')) %></span>
      </div>
      <div class="text-right max-w-md">
        <span class="font-mono text-xs uppercase tracking-widest text-slate-400 block">Assessment</span>
        <p class="text-slate-300 text-sm mt-2"><%= @plan.dig('level_assessment', 'reasoning') %></p>
      </div>
    </div>
  </div>

  <!-- Goals -->
  <div class="mt-8">
    <h2 class="font-mono text-xs uppercase tracking-widest text-slate-400 mb-4">Goals (<%= @plan['goals']&.length || 0 %>)</h2>
    <div class="space-y-3">
      <% @plan['goals']&.each_with_index do |goal, idx| %>
        <div class="bg-slate-900 border border-slate-700 rounded-lg p-4">
          <div class="flex items-start gap-4">
            <div class="w-8 h-8 bg-blue-500/20 rounded flex items-center justify-center flex-shrink-0">
              <span class="text-blue-400 text-sm font-mono"><%= idx + 1 %></span>
            </div>
            <div class="flex-1">
              <p class="text-slate-100"><%= goal['content'] %></p>
              <div class="flex flex-wrap gap-2 mt-3 text-xs">
                <span class="bg-blue-900/50 text-blue-400 px-2 py-1 rounded"><%= priority_label(goal['priority']) %></span>
                <span class="bg-slate-800 text-slate-400 px-2 py-1 rounded"><%= goal_type_label(goal['goal_type']) %></span>
                <span class="bg-slate-800 text-slate-400 px-2 py-1 rounded"><%= timeframe_label(goal['timeframe']) %></span>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Missions -->
  <div class="mt-8">
    <h2 class="font-mono text-xs uppercase tracking-widest text-slate-400 mb-4">Missions (<%= @plan['missions']&.length || 0 %>)</h2>
    <div class="space-y-6">
      <% @plan['missions']&.each_with_index do |mission, idx| %>
        <div class="bg-slate-900 border border-slate-700 rounded-lg overflow-hidden">
          <!-- Mission Header -->
          <div class="p-4 border-b border-slate-700">
            <div class="flex items-start justify-between">
              <div>
                <div class="flex items-center gap-2">
                  <span class="font-mono text-xs text-slate-500">Mission <%= idx + 1 %></span>
                  <span class="font-mono text-xs px-2 py-0.5 rounded bg-slate-800 text-slate-400">
                    Grade <%= mission['grade'] %> · <%= grade_label(mission['grade']) %>
                  </span>
                </div>
                <h3 class="font-mono text-lg text-slate-100 mt-1"><%= mission['title'] %></h3>
                <p class="text-slate-400 text-sm mt-1"><%= mission['description'] %></p>
              </div>
              <div class="text-right">
                <span class="font-mono text-xs text-slate-500">Target Level</span>
                <span class="block font-mono text-xl text-blue-400">L<%= mission['target_level'] %></span>
                <span class="text-slate-400 text-xs"><%= level_title(mission['target_level']) %></span>
              </div>
            </div>
          </div>

          <!-- Objectives -->
          <div class="divide-y divide-slate-800">
            <% mission['objectives']&.each do |obj| %>
              <div class="p-4 flex items-start gap-4">
                <div class="w-6 h-6 bg-slate-800 rounded flex items-center justify-center flex-shrink-0">
                  <span class="font-mono text-xs text-slate-400"><%= obj['position'] %></span>
                </div>
                <div class="flex-1">
                  <p class="text-slate-200 text-sm"><%= obj['description'] %></p>
                  <div class="flex items-center gap-3 mt-2 flex-wrap">
                    <% if obj['skill_name'].present? %>
                      <span class="text-xs bg-blue-900/50 text-blue-400 px-2 py-1 rounded">Skill: <%= obj['skill_name'] %></span>
                    <% end %>
                    <span class="text-xs bg-slate-800 text-slate-400 px-2 py-1 rounded">
                      <%= difficulty_label(obj['difficulty']) %>
                    </span>
                    <span class="text-xs text-emerald-400">+<%= [25, 50, 75, 100][obj['difficulty'].to_i - 1] || 25 %> XP</span>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Actions -->
  <div class="mt-8 flex gap-4" data-controller="operator">
    <%= button_to "Regenerate", generate_plan_domain_path(@domain.slug), method: :post,
        class: "flex-1 bg-slate-700 hover:bg-slate-600 text-white font-mono uppercase tracking-wide text-sm px-4 py-3 rounded transition-colors",
        data: { turbo_confirm: "Generate a new plan? Your current plan will be replaced." } %>
    <%= button_to "Confirm & Create", confirm_plan_domain_path(@domain.slug), method: :post,
        class: "flex-1 bg-emerald-600 hover:bg-emerald-500 text-white font-mono uppercase tracking-wide text-sm px-4 py-3 rounded transition-colors" %>
  </div>

  <div class="mt-4 text-center">
    <%= link_to "Cancel", domain_path(@domain.slug),
        class: "font-mono text-xs text-slate-500 hover:text-slate-300" %>
  </div>
</div>
