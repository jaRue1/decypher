<div id="mission_header" class="bg-slate-900 border border-slate-700 rounded-lg p-6 mb-6">
  <div class="flex items-start justify-between mb-4">
    <div>
      <div class="flex items-center gap-3 mb-1">
        <span class="font-mono text-xs uppercase tracking-widest text-slate-500"><%= mission.domain.name %></span>
        <% if mission.grade.present? %>
          <span class="font-mono text-xs px-2 py-0.5 rounded <%= grade_color(mission.grade) %>">
            Grade <%= mission.grade %>
          </span>
        <% end %>
      </div>
      <h1 class="font-mono text-2xl text-slate-100 mt-1"><%= mission.title %></h1>
    </div>
    <div class="flex items-center gap-2">
      <% if mission.status == "standby" %>
        <%= link_to "Edit", edit_mission_path(mission), class: "font-mono text-xs text-slate-400 hover:text-white px-3 py-1 border border-slate-700 rounded hover:border-slate-500 transition-colors" %>
        <div data-controller="confirm">
          <%= button_to mission_path(mission), method: :delete,
              data: { action: "click->confirm#open" },
              class: "font-mono text-xs text-red-400 hover:text-red-300 px-3 py-1 border border-red-900 rounded hover:border-red-700 transition-colors" do %>
            Delete
          <% end %>
          <%= render "shared/confirm_modal" %>
        </div>
      <% end %>
    </div>
  </div>

  <p class="text-slate-400 mb-4"><%= mission.description %></p>

  <!-- Status Bar -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4 text-xs font-mono">
      <span class="px-2 py-1 rounded <%= status_color(mission.status) %>">
        <%= mission.status&.upcase || 'STANDBY' %>
      </span>
      <span class="text-slate-500">
        <%= mission.completion_percentage %>% complete
      </span>
      <span class="text-slate-500">
        <%= mission.total_xp %> XP potential
      </span>
    </div>

    <!-- Action Buttons -->
    <div class="flex items-center gap-2">
      <% if mission.status == "standby" %>
        <div data-controller="operator">
          <%= button_to generate_habits_mission_path(mission), method: :post,
              class: "font-mono text-xs text-blue-400 hover:text-blue-300 px-3 py-1 border border-blue-700 rounded hover:border-blue-500 transition-colors" do %>
            Generate Habits
          <% end %>
        </div>
        <%= button_to commence_mission_path(mission), method: :post,
            class: "bg-emerald-600 hover:bg-emerald-500 text-white font-mono text-xs px-4 py-2 rounded transition-colors" do %>
          Commence Mission
        <% end %>
      <% elsif mission.status == "active" %>
        <div data-controller="confirm">
          <%= button_to abort_mission_mission_path(mission), method: :post,
              data: { action: "click->confirm#open" },
              class: "font-mono text-xs text-amber-400 hover:text-amber-300 px-3 py-1 border border-amber-700 rounded hover:border-amber-500 transition-colors" do %>
            Abort Mission
          <% end %>
          <%= render "shared/abort_modal" %>
        </div>
      <% elsif mission.status == "completed" %>
        <span class="font-mono text-xs text-emerald-400 px-3 py-1 bg-emerald-400/10 rounded">
          Mission Accomplished
        </span>
      <% elsif mission.status == "aborted" %>
        <%= button_to commence_mission_path(mission), method: :post,
            class: "bg-amber-600 hover:bg-amber-500 text-white font-mono text-xs px-4 py-2 rounded transition-colors" do %>
          Resume Mission
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="mt-4">
    <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
      <div class="h-full bg-blue-500 transition-all duration-500" style="width: <%= mission.completion_percentage %>%"></div>
    </div>
  </div>

  <% if mission.started_at.present? %>
    <div class="mt-4 text-xs font-mono text-slate-500">
      Started <%= time_ago_in_words(mission.started_at) %> ago
      <% if mission.completed_at.present? %>
        Â· Completed <%= time_ago_in_words(mission.completed_at) %> ago
      <% end %>
    </div>
  <% end %>
</div>
