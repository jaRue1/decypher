<div class="p-8">
  <!-- Header with Month Navigation -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-1">Journal</h1>
      <p class="font-mono text-2xl text-slate-100"><%= @date.strftime("%B %Y") %></p>
    </div>
    <div class="flex items-center gap-2">
      <%= link_to daily_entries_path(date: @date - 1.month), class: "p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      <% end %>
      <% if @date.beginning_of_month != Date.current.beginning_of_month %>
        <%= link_to "Today", daily_entries_path(date: Date.current), class: "font-mono text-xs text-blue-400 hover:text-blue-300 px-3 py-1 border border-blue-400/30 rounded" %>
      <% end %>
      <% if @date.beginning_of_month < Date.current.beginning_of_month %>
        <%= link_to daily_entries_path(date: @date + 1.month), class: "p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        <% end %>
      <% else %>
        <div class="p-2 text-slate-700">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </div>
      <% end %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Calendar (3 cols) -->
    <div class="lg:col-span-3">
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <!-- Day Headers -->
        <div class="grid grid-cols-7 gap-1 mb-2">
          <% %w[Sun Mon Tue Wed Thu Fri Sat].each do |day| %>
            <div class="text-center font-mono text-xs text-slate-500 py-2"><%= day %></div>
          <% end %>
        </div>

        <!-- Calendar Grid -->
        <div class="grid grid-cols-7 gap-1">
          <% @calendar_dates.each do |date| %>
            <% entry = @entries[date] %>
            <% is_current_month = date.month == @date.month %>
            <% is_today = date == Date.current %>
            <% is_future = date > Date.current %>

            <% if is_future %>
              <!-- Future date (not clickable) -->
              <div class="aspect-square p-2 rounded-lg bg-slate-900/30 <%= is_current_month ? '' : 'opacity-30' %>">
                <span class="font-mono text-xs text-slate-700"><%= date.day %></span>
              </div>
            <% else %>
              <!-- Past or today (clickable) -->
              <%= link_to daily_entry_path(date: date), class: "aspect-square p-2 rounded-lg transition-colors #{is_today ? 'bg-blue-600/20 border border-blue-500' : 'bg-slate-800 hover:bg-slate-700'} #{is_current_month ? '' : 'opacity-40'}" do %>
                <div class="h-full flex flex-col">
                  <span class="font-mono text-xs <%= is_today ? 'text-blue-400 font-bold' : 'text-slate-400' %>"><%= date.day %></span>

                  <% if entry %>
                    <!-- Entry indicators -->
                    <div class="flex-1 flex flex-col justify-end">
                      <div class="flex flex-wrap gap-0.5 mt-1">
                        <% if entry.mood_score.present? %>
                          <div class="w-2 h-2 rounded-full bg-blue-500" title="Mood: <%= entry.mood_score %>"></div>
                        <% end %>
                        <% if entry.motivation_score.present? %>
                          <div class="w-2 h-2 rounded-full bg-emerald-500" title="Motivation: <%= entry.motivation_score %>"></div>
                        <% end %>
                        <% if entry.wins.present? %>
                          <div class="w-2 h-2 rounded-full bg-amber-500" title="Wins recorded"></div>
                        <% end %>
                        <% if entry.improvements.present? %>
                          <div class="w-2 h-2 rounded-full bg-purple-500" title="Improvements recorded"></div>
                        <% end %>
                        <% if entry.notes.present? %>
                          <div class="w-2 h-2 rounded-full bg-slate-400" title="Notes recorded"></div>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sidebar (1 col) -->
    <div class="space-y-6">
      <!-- Month/Year Selector -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-4">Go To</h3>
        <%= form_with url: daily_entries_path, method: :get, data: { controller: "auto-submit" }, class: "space-y-3" do |f| %>
          <div>
            <label class="block font-mono text-xs text-slate-400 mb-1">Year</label>
            <select name="year"
                    data-action="change->auto-submit#submit"
                    class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-slate-100 font-mono text-sm focus:outline-none focus:border-blue-500">
              <% (Date.current.year.downto(Date.current.year - 10)).each do |year| %>
                <option value="<%= year %>" <%= 'selected' if year == @date.year %>><%= year %></option>
              <% end %>
            </select>
          </div>
          <div>
            <label class="block font-mono text-xs text-slate-400 mb-1">Month</label>
            <select name="month"
                    data-action="change->auto-submit#submit"
                    class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-slate-100 font-mono text-sm focus:outline-none focus:border-blue-500">
              <% Date::MONTHNAMES.compact.each_with_index do |month_name, index| %>
                <% month_num = index + 1 %>
                <% disabled = @date.year == Date.current.year && month_num > Date.current.month %>
                <option value="<%= month_num %>"
                        <%= 'selected' if month_num == @date.month %>
                        <%= 'disabled' if disabled %>
                        class="<%= 'text-slate-600' if disabled %>">
                  <%= month_name %>
                </option>
              <% end %>
            </select>
          </div>
        <% end %>
      </div>

      <!-- Legend -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-4">Legend</h3>
        <div class="space-y-3">
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
            <span class="font-mono text-xs text-slate-400">Mood recorded</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
            <span class="font-mono text-xs text-slate-400">Motivation recorded</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-amber-500"></div>
            <span class="font-mono text-xs text-slate-400">Wins recorded</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-purple-500"></div>
            <span class="font-mono text-xs text-slate-400">Improvements recorded</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-slate-400"></div>
            <span class="font-mono text-xs text-slate-400">Notes recorded</span>
          </div>
        </div>
      </div>

      <!-- Month Stats -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-4">Month Stats</h3>
        <% entries_with_mood = @entries.values.count { |e| e.mood_score.present? } %>
        <% entries_with_motivation = @entries.values.count { |e| e.motivation_score.present? } %>
        <% avg_mood = @entries.values.filter_map(&:mood_score).then { |scores| scores.any? ? (scores.sum.to_f / scores.size).round(1) : nil } %>
        <% avg_motivation = @entries.values.filter_map(&:motivation_score).then { |scores| scores.any? ? (scores.sum.to_f / scores.size).round(1) : nil } %>
        <% days_in_month = [@month_end.day, Date.current.day].min %>

        <div class="space-y-4">
          <div>
            <div class="flex items-center justify-between mb-1">
              <span class="font-mono text-xs text-slate-400">Entries</span>
              <span class="font-mono text-sm text-slate-200"><%= @entries.size %> / <%= days_in_month %></span>
            </div>
            <div class="h-1.5 bg-slate-800 rounded-full overflow-hidden">
              <div class="h-full bg-blue-500 transition-all" style="width: <%= (@entries.size.to_f / days_in_month * 100).round %>%"></div>
            </div>
          </div>

          <% if avg_mood %>
            <div class="flex items-center justify-between">
              <span class="font-mono text-xs text-slate-400">Avg Mood</span>
              <span class="font-mono text-sm text-blue-400"><%= avg_mood %>/10</span>
            </div>
          <% end %>

          <% if avg_motivation %>
            <div class="flex items-center justify-between">
              <span class="font-mono text-xs text-slate-400">Avg Motivation</span>
              <span class="font-mono text-sm text-emerald-400"><%= avg_motivation %>/10</span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-4">Quick Actions</h3>
        <div class="space-y-2">
          <%= link_to daily_entry_path(date: Date.current), class: "flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-800 transition-colors" do %>
            <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            <span class="font-mono text-sm text-slate-300">Today's Entry</span>
          <% end %>
          <%= link_to habits_path, class: "flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-800 transition-colors" do %>
            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
            </svg>
            <span class="font-mono text-sm text-slate-300">Habit Tracker</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
