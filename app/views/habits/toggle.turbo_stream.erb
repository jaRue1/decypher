<%# Update the toggle button %>
<%= turbo_stream.replace dom_id(@habit, @date) do %>
  <%= turbo_frame_tag dom_id(@habit, @date) do %>
    <%= button_to toggle_habit_path(@habit, date: @date),
        method: :post,
        class: "w-6 h-6 mx-auto rounded flex items-center justify-center transition-colors #{@log.completed ? 'bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30' : 'bg-slate-800 text-slate-600 hover:bg-slate-700 hover:text-slate-400'}",
        data: { turbo_frame: dom_id(@habit, @date) } do %>
      <% if @log.completed %>
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
        </svg>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%# Update stats bar %>
<%= turbo_stream.replace "habits_stats_bar" do %>
  <%= render partial: "habits/stats_bar", locals: { stats: @stats } %>
<% end %>

<%# Update weekly progress chart %>
<%= turbo_stream.replace "habits_weekly_progress" do %>
  <%= render partial: "habits/weekly_progress", locals: {
    week_labels: @week_labels,
    week_completed: @week_completed,
    week_percentage: @week_percentage,
    week_total_completed: @week_total_completed,
    week_total_possible: @week_total_possible
  } %>
<% end %>

<%# Update monthly progress %>
<%= turbo_stream.replace "habits_monthly_progress" do %>
  <%= render partial: "habits/monthly_progress", locals: { stats: @stats } %>
<% end %>

<%# Update today's progress %>
<%= turbo_stream.replace "habits_today_progress" do %>
  <%= render partial: "habits/today_progress", locals: {
    today_completed: @today_completed,
    today_percentage: @today_percentage,
    habits_count: @habits.count
  } %>
<% end %>

<%# Update goal vs actual %>
<%= turbo_stream.replace "habits_goal_vs_actual" do %>
  <%= render partial: "habits/goal_vs_actual", locals: { habits: @habits, date: @date } %>
<% end %>

<%# Update current streaks %>
<%= turbo_stream.replace "habits_current_streaks" do %>
  <%= render partial: "habits/current_streaks", locals: { habits: @habits } %>
<% end %>
