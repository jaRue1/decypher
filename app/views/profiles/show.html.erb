<div class="p-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-1">Operator Profile</h1>
      <div class="flex items-center gap-3">
        <p class="font-mono text-2xl text-slate-100"><%= @user.username.presence || @user.email_address.split('@').first %></p>
        <%= link_to edit_profile_path, class: "text-slate-500 hover:text-blue-400 transition-colors", title: "Edit profile" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
        <% end %>
      </div>
      <p class="font-mono text-xs text-slate-500 mt-1">Member since <%= @user.created_at.strftime("%B %Y") %></p>
    </div>
    <div class="text-right">
      <span class="font-mono text-xs text-slate-500"><%= @user.email_address %></span>
    </div>
  </div>

  <!-- Top Stats Row -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- Power Level Card -->
    <div class="bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <span class="font-mono text-xs uppercase tracking-widest text-slate-500">Power Level</span>
        <span class="font-mono text-xs text-slate-500">Max: 80</span>
      </div>
      <div class="flex items-end gap-4">
        <span class="font-mono text-6xl text-blue-400 font-bold"><%= @power_level %></span>
        <div class="flex-1 pb-2">
          <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-blue-600 to-cyan-400 transition-all" style="width: <%= (@power_level / 80.0 * 100).round %>%"></div>
          </div>
          <p class="font-mono text-xs text-slate-500 mt-1"><%= @user_domains.count %>/8 domains active</p>
        </div>
      </div>
    </div>

    <!-- Total XP Card -->
    <div class="bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <span class="font-mono text-xs uppercase tracking-widest text-slate-500">Total XP Earned</span>
        <span class="font-mono text-xs text-slate-500">Lifetime</span>
      </div>
      <div class="flex items-end gap-4">
        <span class="font-mono text-6xl text-emerald-400 font-bold"><%= number_with_delimiter(@total_xp) %></span>
        <div class="pb-2">
          <p class="font-mono text-xs text-slate-500">Experience Points</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Cards Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
    <!-- Domains Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Domains</h3>
        <%= link_to "View All", root_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300" %>
      </div>
      <div class="flex justify-center mb-4">
        <div class="w-48 h-48">
          <%= render "shared/octagon", domains: @domains, user_domains: @user_domains, power_level: @power_level %>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-2">
        <% @domains.first(4).each do |domain| %>
          <% user_domain = @user_domains[domain.id] %>
          <div class="flex items-center justify-between bg-slate-800 rounded px-2 py-1">
            <span class="font-mono text-xs text-slate-400 truncate"><%= domain.name %></span>
            <span class="font-mono text-xs <%= user_domain ? 'text-blue-400' : 'text-slate-600' %>">
              L<%= user_domain&.level || 0 %>
            </span>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Missions Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Missions</h3>
        <%= link_to "View All", missions_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300" %>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="text-center">
          <span class="font-mono text-3xl text-amber-400 block"><%= @missions_completed %></span>
          <span class="font-mono text-xs text-slate-500">Completed</span>
        </div>
        <div class="text-center">
          <span class="font-mono text-3xl text-purple-400 block"><%= @total_skills %></span>
          <span class="font-mono text-xs text-slate-500">Skills</span>
        </div>
      </div>
      <% if @active_missions.any? %>
        <div class="space-y-2">
          <span class="font-mono text-xs text-slate-500">Active:</span>
          <% @active_missions.first(3).each do |mission| %>
            <%= link_to mission_path(mission), class: "block bg-slate-800 rounded p-2 hover:bg-slate-700 transition-colors" do %>
              <div class="flex items-center justify-between">
                <span class="font-mono text-xs text-slate-300 truncate"><%= mission.title %></span>
                <span class="font-mono text-xs text-slate-500"><%= mission.completion_percentage %>%</span>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <p class="font-mono text-xs text-slate-500 text-center py-4">No active missions</p>
      <% end %>
    </div>

    <!-- Achievements Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Recent Achievements</h3>
        <span class="font-mono text-xs text-slate-500"><%= @recent_achievements.count %> recent</span>
      </div>
      <% if @recent_achievements.any? %>
        <div class="space-y-3">
          <% @recent_achievements.first(5).each do |achievement| %>
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center <%= achievement_icon_color(achievement.achievement_type) %>">
                <%= achievement_icon(achievement.achievement_type) %>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-mono text-xs text-slate-300 truncate"><%= achievement.description %></p>
                <p class="font-mono text-xs text-slate-600">
                  <%= achievement.achieved_at ? time_ago_in_words(achievement.achieved_at) + " ago" : "" %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="font-mono text-xs text-slate-500 text-center py-4">No achievements yet</p>
      <% end %>
    </div>

    <!-- Habits Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Habits</h3>
        <%= link_to "View All", habits_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300" %>
      </div>
      <% if @habits.any? %>
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div class="text-center">
            <span class="font-mono text-3xl text-emerald-400 block"><%= @habits_stats[:percentage].round(0) %>%</span>
            <span class="font-mono text-xs text-slate-500">This Month</span>
          </div>
          <div class="text-center">
            <span class="font-mono text-3xl text-slate-300 block"><%= @habits.count %></span>
            <span class="font-mono text-xs text-slate-500">Active</span>
          </div>
        </div>
        <% if @top_streaks.any? { |h| h.current_streak > 0 } %>
          <div class="space-y-2">
            <span class="font-mono text-xs text-slate-500">Top Streaks:</span>
            <% @top_streaks.select { |h| h.current_streak > 0 }.first(3).each do |habit| %>
              <div class="flex items-center justify-between bg-slate-800 rounded px-2 py-1">
                <span class="font-mono text-xs text-slate-400 truncate"><%= habit.name %></span>
                <div class="flex items-center gap-1">
                  <span class="font-mono text-xs text-amber-400"><%= habit.current_streak %></span>
                  <span class="text-amber-400 text-xs">ðŸ”¥</span>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="font-mono text-xs text-slate-500 text-center">No active streaks</p>
        <% end %>
      <% else %>
        <p class="font-mono text-xs text-slate-500 text-center py-4">No habits tracked</p>
        <%= link_to "Create a habit", new_habit_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300 block text-center" %>
      <% end %>
    </div>

    <!-- Journal Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Journal</h3>
        <%= link_to "View All", daily_entries_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300" %>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="text-center">
          <span class="font-mono text-3xl text-blue-400 block"><%= @avg_mood || "--" %></span>
          <span class="font-mono text-xs text-slate-500">Avg Mood</span>
        </div>
        <div class="text-center">
          <span class="font-mono text-3xl text-emerald-400 block"><%= @avg_motivation || "--" %></span>
          <span class="font-mono text-xs text-slate-500">Avg Motivation</span>
        </div>
      </div>
      <% if @recent_entries.any? %>
        <div class="space-y-2">
          <span class="font-mono text-xs text-slate-500">Recent Entries:</span>
          <% @recent_entries.first(3).each do |entry| %>
            <%= link_to daily_entry_path(date: entry.date), class: "block bg-slate-800 rounded px-2 py-1 hover:bg-slate-700 transition-colors" do %>
              <div class="flex items-center justify-between">
                <span class="font-mono text-xs text-slate-400"><%= entry.date.strftime("%a, %b %d") %></span>
                <div class="flex items-center gap-2">
                  <% if entry.mood_score %>
                    <span class="font-mono text-xs text-blue-400"><%= entry.mood_score %></span>
                  <% end %>
                  <% if entry.motivation_score %>
                    <span class="font-mono text-xs text-emerald-400"><%= entry.motivation_score %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <p class="font-mono text-xs text-slate-500 text-center py-4">No journal entries</p>
        <%= link_to "Start journaling", daily_entry_path(date: Date.current), class: "font-mono text-xs text-blue-400 hover:text-blue-300 block text-center" %>
      <% end %>
    </div>

    <!-- Skills Card -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-mono text-xs uppercase tracking-widest text-slate-500">Skills Acquired</h3>
        <span class="font-mono text-xs text-slate-500"><%= @total_skills %> total</span>
      </div>
      <% if @skills_by_domain.any? %>
        <div class="space-y-3">
          <% @skills_by_domain.first(3).each do |domain, skills| %>
            <div>
              <span class="font-mono text-xs text-slate-500 block mb-1"><%= domain&.name || "General" %></span>
              <div class="flex flex-wrap gap-1">
                <% skills.first(4).each do |skill| %>
                  <span class="font-mono text-xs bg-slate-800 text-slate-300 px-2 py-0.5 rounded">
                    <%= skill.name %>
                  </span>
                <% end %>
                <% if skills.count > 4 %>
                  <span class="font-mono text-xs text-slate-500 px-2 py-0.5">+<%= skills.count - 4 %></span>
                <% end %>
              </div>
            </div>
          <% end %>
          <% if @skills_by_domain.count > 3 %>
            <p class="font-mono text-xs text-slate-500">+ <%= @skills_by_domain.count - 3 %> more domains</p>
          <% end %>
        </div>
      <% else %>
        <p class="font-mono text-xs text-slate-500 text-center py-4">No skills acquired yet</p>
        <p class="font-mono text-xs text-slate-600 text-center">Complete objectives to gain skills</p>
      <% end %>
    </div>
  </div>
</div>
