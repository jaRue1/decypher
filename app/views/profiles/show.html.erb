<div class="p-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-1">Operator Profile</h1>
    <p class="font-mono text-2xl text-slate-100"><%= @user.email_address %></p>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <!-- Power Level -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <span class="font-mono text-xs uppercase tracking-widest text-slate-500 block mb-2">Power Level</span>
      <span class="font-mono text-4xl text-blue-400 block"><%= @power_level %></span>
      <div class="mt-3 h-2 bg-slate-800 rounded-full overflow-hidden">
        <div class="h-full bg-gradient-to-r from-blue-600 to-cyan-400" style="width: <%= [@power_level, 100].min %>%"></div>
      </div>
      <span class="font-mono text-xs text-slate-500 mt-2 block">Max: 80 (8 domains × 10 levels)</span>
    </div>

    <!-- Total XP -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <span class="font-mono text-xs uppercase tracking-widest text-slate-500 block mb-2">Total XP Earned</span>
      <span class="font-mono text-4xl text-emerald-400 block"><%= number_with_delimiter(@total_xp) %></span>
      <span class="font-mono text-xs text-slate-500 mt-2 block">Lifetime experience</span>
    </div>

    <!-- Missions Completed -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <span class="font-mono text-xs uppercase tracking-widest text-slate-500 block mb-2">Missions Completed</span>
      <span class="font-mono text-4xl text-amber-400 block"><%= @missions_completed %></span>
      <span class="font-mono text-xs text-slate-500 mt-2 block"><%= @active_missions.count %> active</span>
    </div>

    <!-- Skills Acquired -->
    <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
      <span class="font-mono text-xs uppercase tracking-widest text-slate-500 block mb-2">Skills Acquired</span>
      <span class="font-mono text-4xl text-purple-400 block"><%= @total_skills %></span>
      <span class="font-mono text-xs text-slate-500 mt-2 block">Across <%= @skills_by_domain.keys.count %> domains</span>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Domain Levels (2 columns) -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Domain Progress -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h2 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-6">Domain Progress</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% @domains.each do |domain| %>
            <% user_domain = @user_domains[domain.id] %>
            <%= link_to domain_path(domain.slug), class: "block bg-slate-800 rounded-lg p-4 hover:bg-slate-700 transition-colors group" do %>
              <div class="flex items-center justify-between mb-2">
                <span class="font-mono text-sm text-slate-300 group-hover:text-white"><%= domain.name %></span>
                <% if user_domain %>
                  <span class="font-mono text-xs text-blue-400 bg-blue-400/10 px-2 py-1 rounded">
                    L<%= user_domain.level %> · <%= user_domain.current_grade || 'D' %>
                  </span>
                <% else %>
                  <span class="font-mono text-xs text-slate-500 bg-slate-700 px-2 py-1 rounded">Not started</span>
                <% end %>
              </div>
              <% if user_domain %>
                <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-blue-500 transition-all" style="width: <%= user_domain.level_progress_percentage %>%"></div>
                </div>
                <div class="flex justify-between mt-2">
                  <span class="font-mono text-xs text-slate-500"><%= user_domain.xp || 0 %> / 400 XP</span>
                  <% if user_domain.maxed? %>
                    <span class="font-mono text-xs text-emerald-400">MAX</span>
                  <% end %>
                </div>
              <% else %>
                <div class="h-2 bg-slate-700 rounded-full"></div>
                <span class="font-mono text-xs text-slate-600 mt-2 block">Click to set up →</span>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- Active Missions -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="font-mono text-xs uppercase tracking-widest text-slate-500">Active Missions</h2>
          <%= link_to "View All", missions_path, class: "font-mono text-xs text-blue-400 hover:text-blue-300" %>
        </div>
        <% if @active_missions.any? %>
          <div class="space-y-3">
            <% @active_missions.each do |mission| %>
              <%= link_to mission_path(mission), class: "block bg-slate-800 rounded-lg p-4 hover:bg-slate-700 transition-colors" do %>
                <div class="flex items-center justify-between mb-2">
                  <span class="font-mono text-sm text-slate-300"><%= mission.title %></span>
                  <span class="font-mono text-xs px-2 py-0.5 rounded bg-blue-400/10 text-blue-400">
                    Grade <%= mission.grade %>
                  </span>
                </div>
                <div class="flex items-center gap-4 text-xs font-mono">
                  <span class="text-slate-500"><%= mission.domain.name %></span>
                  <span class="text-slate-500"><%= mission.completion_percentage %>% complete</span>
                  <span class="text-slate-500"><%= mission.objectives.completed.count %>/<%= mission.objectives.count %> objectives</span>
                </div>
                <div class="mt-2 h-1 bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-blue-500" style="width: <%= mission.completion_percentage %>%"></div>
                </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <p class="text-slate-500 font-mono text-sm">No active missions. <%= link_to "Start one", missions_path, class: "text-blue-400 hover:text-blue-300" %>.</p>
        <% end %>
      </div>

      <!-- Skills by Domain -->
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h2 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-6">Skills Acquired</h2>
        <% if @skills_by_domain.any? %>
          <div class="space-y-6">
            <% @skills_by_domain.each do |domain, skills| %>
              <div>
                <h3 class="font-mono text-xs text-slate-400 mb-3"><%= domain&.name || "General" %></h3>
                <div class="flex flex-wrap gap-2">
                  <% skills.each do |skill| %>
                    <span class="font-mono text-xs bg-slate-800 text-slate-300 px-3 py-1.5 rounded-full border border-slate-700">
                      <%= skill.name %>
                      <span class="text-emerald-400 ml-1">+<%= skill.xp_value %></span>
                    </span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-slate-500 font-mono text-sm">No skills acquired yet. Complete objectives to gain skills.</p>
        <% end %>
      </div>
    </div>

    <!-- Achievements Timeline (1 column) -->
    <div class="lg:col-span-1">
      <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
        <h2 class="font-mono text-xs uppercase tracking-widest text-slate-500 mb-6">Recent Achievements</h2>
        <% if @recent_achievements.any? %>
          <div class="space-y-4">
            <% @recent_achievements.each do |achievement| %>
              <div class="flex gap-3">
                <!-- Achievement Icon -->
                <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center <%= achievement_icon_color(achievement.achievement_type) %>">
                  <%= achievement_icon(achievement.achievement_type) %>
                </div>
                <!-- Achievement Details -->
                <div class="flex-1 min-w-0">
                  <p class="font-mono text-sm text-slate-300 truncate"><%= achievement.description %></p>
                  <p class="font-mono text-xs text-slate-500">
                    <% if achievement.achieved_at %>
                      <%= time_ago_in_words(achievement.achieved_at) %> ago
                    <% end %>
                    <% if achievement.metadata && achievement.metadata["xp_earned"] %>
                      <span class="text-emerald-400">+<%= achievement.metadata["xp_earned"] %> XP</span>
                    <% end %>
                  </p>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-slate-500 font-mono text-sm">No achievements yet. Complete objectives and missions to earn achievements.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
